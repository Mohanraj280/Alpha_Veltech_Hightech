<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Assessment</title>
    <link rel="stylesheet" href="assess.css">
</head>
<body>
<h2>Create Assessment</h2>
<br>
<br>
<!-- Step 1: Module Creation -->

<form id="moduleForm">
    <input type="text" id="moduleName" placeholder="Module Name" required><br>
    <input type="text" id="moduleDescription" placeholder="Module Description" required><br>
    <input type="number" id="numQuestions" placeholder="Number of Questions" required><br>
    <button type="button" onclick="createQuestionFields()">Next</button>
</form>

<!-- Step 2: Questions Input -->
<div id="questionsContainer" style="display: none;">
    <form id="questionsForm"></form><br>
    <button type="button" onclick="submitAssessment()">Submit</button>
</div>

<script>
    // Dynamically create question fields
    function createQuestionFields() {
        const numQuestions = document.getElementById('numQuestions').value;
        const questionsContainer = document.getElementById('questionsContainer');
        const questionsForm = document.getElementById('questionsForm');

        questionsForm.innerHTML = ''; // Clear previous form

        for (let i = 1; i <= numQuestions; i++) {
            questionsForm.innerHTML += `
            <h3>Question ${i}</h3>
            <input type="text" name="question${i}" placeholder="Question ${i}" required><br>
            <input type="text" name="options_${i}" placeholder="Options (comma separated)" required><br>
            <input type="text" name="correctAnswer${i}" placeholder="Correct Answer" required><br><hr>
        `;
        }

        document.getElementById('moduleForm').style.display = 'none'; // Hide the module form
        questionsContainer.style.display = 'block'; // Show the questions input form
    }

    // Submit assessment (can send via API)
    function submitAssessment() {
        const moduleName = document.getElementById('moduleName').value;
        const moduleDescription = document.getElementById('moduleDescription').value;
        const questions = [];

        // Collect questions from the form
        for (let i = 1; i <= document.getElementById('numQuestions').value; i++) {
            const questionText = document.querySelector(`input[name="question${i}"]`).value;
            const optionsInput = document.querySelector(`input[name="options_${i}"]`).value;
            const options = optionsInput.split(',').map(option => option.trim()); // Split and trim options
            const correctAnswer = document.querySelector(`input[name="correctAnswer${i}"]`).value;

            // Generate a unique ID using timestamp and random number
            const uniqueId = `question_${Date.now()}_${Math.floor(Math.random() * 1000)}`;

            // Add question with unique id to questions array
            questions.push({ id: uniqueId, questionText, options, correctAnswer });
        }

        const assessmentData = { moduleName, moduleDescription, questions };
        console.log('Assessment Data:', assessmentData);

        // Submit assessment data to backend
        fetch('/api/assessment/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(assessmentData)
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                // Handle success (e.g., display a message or redirect to a dashboard)
            })
            .catch(error => {
                console.error('Error:', error);
                // Handle error (e.g., display an error message)
            });

        // Redirect to the dashboard after submission
        window.location.href = "dashboard.html";
    }
</script>
</body>
</html>
